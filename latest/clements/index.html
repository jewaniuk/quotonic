
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A platform for performing efficient simulations of nonlinear quantum photonic circuits.">
      
      
        <meta name="author" content="Jacob Ewaniuk">
      
      
        <link rel="canonical" href="https://jewaniuk.github.io/quotonic/latest/clements/">
      
      
        <link rel="prev" href="../fock/">
      
      
        <link rel="next" href="../aa/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>clements - quotonic</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
      <link rel="stylesheet" href="../styles/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quotonic.clements.Mesh" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="quotonic" class="md-header__button md-logo" aria-label="quotonic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            quotonic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              clements
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/jewaniuk/quotonic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    jewaniuk/quotonic
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../fock/" class="md-tabs__link">
        
  
  
    
  
  fock

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  clements

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../aa/" class="md-tabs__link">
        
  
  
    
  
  aa

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../nl/" class="md-tabs__link">
        
  
  
    
  
  nl

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../qpnn/" class="md-tabs__link">
        
  
  
    
  
  qpnn

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../trainer/" class="md-tabs__link">
        
  
  
    
  
  trainer

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../training_sets/" class="md-tabs__link">
        
  
  
    
  
  training_sets

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../perm/" class="md-tabs__link">
        
  
  
    
  
  perm

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../logic/" class="md-tabs__link">
        
  
  
    
  
  logic

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../utils/" class="md-tabs__link">
        
  
  
    
  
  utils

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../types/" class="md-tabs__link">
        
  
  
    
  
  types

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="quotonic" class="md-nav__button md-logo" aria-label="quotonic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    quotonic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jewaniuk/quotonic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    jewaniuk/quotonic
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fock
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    clements
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    clements
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quotonic.clements.Mesh" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quotonic.clements.Mesh.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quotonic.clements.Mesh.mzi" class="md-nav__link">
    <span class="md-ellipsis">
      mzi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quotonic.clements.Mesh.mzi_inv" class="md-nav__link">
    <span class="md-ellipsis">
      mzi_inv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quotonic.clements.Mesh.encode" class="md-nav__link">
    <span class="md-ellipsis">
      encode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quotonic.clements.Mesh.decode" class="md-nav__link">
    <span class="md-ellipsis">
      decode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../aa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    aa
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../nl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nl
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../qpnn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    qpnn
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../trainer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    trainer
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../training_sets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    training_sets
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../perm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    perm
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    logic
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    types
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>clements</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

        <p>The <code>quotonic.clements</code> module includes a class that allows Mach-Zehnder interferometer (MZI) meshes
arranged in the Clements configuration to be instantiated. For each instance, the user may optionally provide values
to quantify experimental imperfections including photon propagation losses and/or imbalanced directional coupler
splitting ratios. Once instantiated, the user may supply a linear unitary transformation that is then decomposed
into phase shifts, or alternatively provide phase shifts to encode a linear unitary (non-unitary if imperfect)
transformation. Note that the code has been designed to produce accurate representations of <span class="arithmatex">\(2\times 2\)</span> meshes (i.e. a
single MZI followed by 2 output phase shifts), however, the documentation corresponds to cases where <span class="arithmatex">\(m &gt; 2\)</span>.</p>
<p>The code in this module has been inspired by the encoding proposed in <a href="https://doi.org/10.1364/OPTICA.3.001460">W. R. Clements <em>et al</em>., "Optimal design for
universal multiport interferometers", <em>Optica</em> <strong>3</strong>, 1460-1465 (2016)</a>,
and its <code>python</code> implementations in both <a href="https://github.com/steinbrecher/bosonic">Bosonic: A Quantum Optics Library</a>,
as originally designed for use in <a href="https://doi.org/10.1038/s41534-019-0174-7">G. R. Steinbrecher <em>et al</em>., “Quantum optical neural networks”,
<em>npj Quantum Inf</em> <strong>5</strong>, 60 (2019)</a>, and <a href="https://github.com/JasvithBasani/CasOptAx">Cascaded Optical Systems
Approach to Neural Networks (CasOptAx)</a> as originally designed for use in
<a href="https://doi.org/10.1038/s41534-025-01096-9">J. R. Basani <em>et al</em>., "Universal logical quantum photonic neural network processor via cavity-assisted
interactions", <em>npj Quantum Inf</em> <strong>11</strong>, 142 (2025)</a>.</p>










  <div class="doc doc-children">















<div class="doc doc-object doc-class">



<h2 id="quotonic.clements.Mesh" class="doc doc-heading">
            <code>Mesh</code>


<a href="#quotonic.clements.Mesh" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Mesh of Mach-Zehnder interferometers arranged in the Clements configuration.</p>
<p>Each mesh of Mach-Zehnder interferometers (MZIs) is classified by a number of optical modes <span class="arithmatex">\(m\)</span>.
Also, fabrication imperfections can optionally be modelled by providing the percentage propagation losses for
each MZI and phase shifter, and/or the imbalanced splitting ratios of each nominally 50:50 directional coupler.</p>
<p>This class features methods to compute the matrix representation (only unitary when lossless) of a mesh from MZI and
output phase shifts, as well as decompose a matrix representation to identify the MZI and output phase shifts
required to realize it. This decomposition follows the scheme of Clements <em>et al</em>. (cited above), yet has been
adjusted to work with the MZI transfer matrix associated with integrated photonic circuits (see <code>decode</code> for
more details).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="quotonic.clements.Mesh.m">m</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of optical modes, <span class="arithmatex">\(m\)</span></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="quotonic.clements.Mesh.ell_mzi">ell_mzi</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(m\times m\)</span> array containing the percentage loss per arm of the interferometer mesh,
for each column of MZIs respectively</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="quotonic.clements.Mesh.ell_ps">ell_ps</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(m\)</span>-length array containing the percentage loss for each of the output phase shifters</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="quotonic.clements.Mesh.t_dc">t_dc</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(2\times m(m-1)/2\)</span> array containing the splitting ratio (T:R) of each directional
coupler in the mesh, organized such that each column corresponds to one MZI, the top row being the first
directional coupler and the bottom being the second, where the MZIs are ordered from top to bottom
followed by left to right across the mesh</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/quotonic/clements.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Mesh</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mesh of Mach-Zehnder interferometers arranged in the Clements configuration.</span>

<span class="sd">    Each mesh of Mach-Zehnder interferometers (MZIs) is classified by a number of optical modes $m$.</span>
<span class="sd">    Also, fabrication imperfections can optionally be modelled by providing the percentage propagation losses for</span>
<span class="sd">    each MZI and phase shifter, and/or the imbalanced splitting ratios of each nominally 50:50 directional coupler.</span>

<span class="sd">    This class features methods to compute the matrix representation (only unitary when lossless) of a mesh from MZI and</span>
<span class="sd">    output phase shifts, as well as decompose a matrix representation to identify the MZI and output phase shifts</span>
<span class="sd">    required to realize it. This decomposition follows the scheme of Clements *et al*. (cited above), yet has been</span>
<span class="sd">    adjusted to work with the MZI transfer matrix associated with integrated photonic circuits (see `decode` for</span>
<span class="sd">    more details).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        m (int): number of optical modes, $m$</span>
<span class="sd">        ell_mzi (jnp_ndarray): $m\\times m$ array containing the percentage loss per arm of the interferometer mesh,</span>
<span class="sd">            for each column of MZIs respectively</span>
<span class="sd">        ell_ps (jnp_ndarray): $m$-length array containing the percentage loss for each of the output phase shifters</span>
<span class="sd">        t_dc (jnp_ndarray): $2\\times m(m-1)/2$ array containing the splitting ratio (T:R) of each directional</span>
<span class="sd">            coupler in the mesh, organized such that each column corresponds to one MZI, the top row being the first</span>
<span class="sd">            directional coupler and the bottom being the second, where the MZIs are ordered from top to bottom</span>
<span class="sd">            followed by left to right across the mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ell_mzi</span><span class="p">:</span> <span class="n">np_ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ell_ps</span><span class="p">:</span> <span class="n">np_ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">t_dc</span><span class="p">:</span> <span class="n">np_ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialization of a Mach-Zehnder interferometer mesh arranged in the Clements configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            m: number of optical modes, $m$</span>
<span class="sd">            ell_mzi: $m\\times m$ array containing the percentage loss per arm of the interferometer mesh,</span>
<span class="sd">                for each column of MZIs respectively</span>
<span class="sd">            ell_ps: $m$-length array containing the percentage loss for each of the output phase shifters</span>
<span class="sd">            t_dc: $2\\times m(m-1)/2$ array containing the splitting ratio (T:R) of each directional coupler in the</span>
<span class="sd">                mesh, organized such that each column corresponds to one MZI, the top row being the first</span>
<span class="sd">                directional coupler and the bottom being the second, where the MZIs are ordered from top to bottom</span>
<span class="sd">                followed by left to right across the mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># fill in missing mesh properties</span>
        <span class="k">if</span> <span class="n">ell_mzi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ell_mzi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ell_ps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ell_ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t_dc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t_dc</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># check the validity of the provided properties</span>
        <span class="k">assert</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Cannot create any kind of interferometer with less than 2 modes&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">ell_mzi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ell_mzi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">ell_mzi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span>
        <span class="p">),</span> <span class="s2">&quot;Loss per arm of the interferometer mesh must take the form of an m x m array&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ell_ps</span><span class="p">)</span> <span class="o">==</span> <span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Loss per output phase shifter in the mesh must be an m-length array&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">t_dc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">t_dc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="p">),</span> <span class="s2">&quot;Directional coupler splitting ratios (T:R) must be passed as a 2 x m(m-1)/2 array&quot;</span>

        <span class="c1"># store the properties of the mesh internally</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ell_mzi</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ell_mzi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ell_ps</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ell_ps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_dc</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t_dc</span><span class="p">)</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mzi</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">phi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp_ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct $2\\times 2$ *ideal* Mach-Zehnder interferometer transfer matrix.</span>

<span class="sd">        The transfer matrix is defined as,</span>

<span class="sd">        $$ \\mathbf{T}_\\mathrm{mzi} = ie^{i\\theta}\\begin{pmatrix} e^{i\\phi}\\sin{\\theta} &amp; \\cos{\\theta}</span>
<span class="sd">        \\\\ e^{i\\phi}\\cos{\\theta} &amp; -\\sin{\\theta} \\end{pmatrix}, $$</span>

<span class="sd">        in the ideal case. See `encode` for further details.</span>

<span class="sd">        Args:</span>
<span class="sd">            phi: phase shift $\\phi$, in radians</span>
<span class="sd">            theta: phase shift $\\theta$, in radians</span>

<span class="sd">        Returns:</span>
<span class="sd">            A $2\\times 2$ complex 2D array representation of the ideal Mach-Zehnder interferometer transfer matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">T00</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">T01</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">T10</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">T11</span> <span class="o">=</span> <span class="o">-</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">T00</span><span class="p">,</span> <span class="n">T01</span><span class="p">],</span> <span class="p">[</span><span class="n">T10</span><span class="p">,</span> <span class="n">T11</span><span class="p">]])</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mzi_inv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">phi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp_ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct $2\\times 2$ inverse of an *ideal* Mach-Zehnder interferometer transfer matrix.</span>

<span class="sd">        The inverse of the transfer matrix is defined as,</span>

<span class="sd">        $$ \\mathbf{T}_\\mathrm{mzi}^\\dagger = -ie^{-i\\theta}\\begin{pmatrix} e^{-i\\phi}\\sin{\\theta} &amp; e^{-i\\phi}</span>
<span class="sd">        \\cos{\\theta} \\\\ \\cos{\\theta} &amp; -\\sin{\\theta} \\end{pmatrix}, $$</span>

<span class="sd">        in the ideal case. See `encode` for further details.</span>

<span class="sd">        Args:</span>
<span class="sd">            phi: phase shift $\\phi$, in radians</span>
<span class="sd">            theta: phase shift $\\theta$, in radians</span>

<span class="sd">        Returns:</span>
<span class="sd">            A $2\\times 2$ complex 2D array representation of the inverse of the ideal Mach-Zehnder interferometer</span>
<span class="sd">                transfer matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">T00</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">T01</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">T10</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">T11</span> <span class="o">=</span> <span class="o">-</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">T00</span><span class="p">,</span> <span class="n">T01</span><span class="p">],</span> <span class="p">[</span><span class="n">T10</span><span class="p">,</span> <span class="n">T11</span><span class="p">]])</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">phi</span><span class="p">:</span> <span class="n">jnp_ndarray</span><span class="p">,</span>
        <span class="n">theta</span><span class="p">:</span> <span class="n">jnp_ndarray</span><span class="p">,</span>
        <span class="n">delta</span><span class="p">:</span> <span class="n">jnp_ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp_ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode a Mach-Zehnder interferometer mesh in the Clements configuration from an array of phase shifts.</span>

<span class="sd">        Each Mach-Zehnder interferometer (MZI), as displayed below, consists of two phase shifters enacting respective</span>
<span class="sd">        phase shifts $\\phi$, $\\theta$, and two directional couplers with respective splitting ratios $t_1$,</span>
<span class="sd">        $t_2$ (ideally, $t_1 = t_2 = 0.5$).</span>

<span class="sd">        &lt;p align=&quot;center&quot;&gt;</span>
<span class="sd">        &lt;img width=&quot;500&quot; src=&quot;../img/light/mzi.png&quot; class=&quot;only-light&quot;&gt;</span>
<span class="sd">        &lt;img width=&quot;500&quot; src=&quot;../img/dark/mzi.png&quot; class=&quot;only-dark&quot;&gt;</span>
<span class="sd">        &lt;/p&gt;</span>

<span class="sd">        The phase shifter transfer matrices are given by,</span>

<span class="sd">        $$ \\mathbf{T}_\\mathrm{ps}(\\phi) = \\begin{pmatrix} e^{i\\phi} &amp; 0 \\\\ 0 &amp; 1 \\end{pmatrix} \\qquad\\qquad</span>
<span class="sd">        \\mathbf{T}_\\mathrm{ps}(2\\theta) = \\begin{pmatrix} e^{i2\\theta} &amp; 0 \\\\ 0 &amp; 1 \\end{pmatrix}, $$</span>

<span class="sd">        for phase shifts $\\phi$ and $2\\theta$ respectively. The directional coupler transfer matrix is given by,</span>

<span class="sd">        $$ \\mathbf{T}_\\mathrm{dc}(t) = \\begin{pmatrix} \\sqrt{t} &amp; i\\sqrt{1-t} \\\\ i\\sqrt{1-t} &amp; \\sqrt{t}</span>
<span class="sd">        \\end{pmatrix}, $$</span>

<span class="sd">        which simplifies to,</span>

<span class="sd">        $$ \\mathbf{T}_\\mathrm{dc}(0.5) = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1 &amp; i \\\\ i &amp; 1 \\end{pmatrix}, $$</span>

<span class="sd">        in the ideal case of $t = 0.5$ (i.e. 50:50). Each MZI may contribute an imbalanced probability of photon loss</span>
<span class="sd">        in each of its arms. This is modelled by multiplying a loss matrix,</span>

<span class="sd">        $$ \\mathbf{T}_\\mathrm{loss}(\\alpha_\\mathrm{up}, \\alpha_\\mathrm{low}) = \\begin{pmatrix}</span>
<span class="sd">        \\sqrt{1 - \\alpha_\\mathrm{up}} &amp; 0 \\\\ 0 &amp; \\sqrt{1 - \\alpha_\\mathrm{low}} \\end{pmatrix}, $$</span>

<span class="sd">        where $\\alpha_\\mathrm{up}$, $\\alpha_\\mathrm{low}$ are the fractions of light lost in the upper and lower</span>
<span class="sd">        arms of the MZI, respectively. Altogether, the MZI transfer matrix is given by,</span>

<span class="sd">        $$ \\mathbf{T}_\\mathrm{mzi} = \\mathbf{T}_\\mathrm{loss}(\\alpha_\\mathrm{up}, \\alpha_\\mathrm{low})</span>
<span class="sd">        \\mathbf{T}_\\mathrm{dc}(t_2) \\mathbf{T}_\\mathrm{ps}(2\\theta) \\mathbf{T}_\\mathrm{dc}(t_1)</span>
<span class="sd">        \\mathbf{T}_\\mathrm{ps}(\\phi) = \\begin{pmatrix} \\sqrt{1 - \\alpha_\\mathrm{up}} &amp; 0 \\\\ 0 &amp; \\sqrt{1 -</span>
<span class="sd">        \\alpha_\\mathrm{low}} \\end{pmatrix} \\begin{pmatrix} \\sqrt{t_2} &amp; i\\sqrt{1-t_2} \\\\ i\\sqrt{1-t_2} &amp;</span>
<span class="sd">        \\sqrt{t_2} \\end{pmatrix} \\begin{pmatrix} e^{i2\\theta} &amp; 0 \\\\ 0 &amp; 1 \\end{pmatrix} \\begin{pmatrix}</span>
<span class="sd">        \\sqrt{t_1} &amp; i\\sqrt{1-t_1} \\\\ i\\sqrt{1-t_1} &amp; \\sqrt{t_1} \\end{pmatrix} \\begin{pmatrix} e^{i\\phi} &amp; 0</span>
<span class="sd">        \\\\ 0 &amp; 1 \\end{pmatrix}, $$</span>

<span class="sd">        which simplifies to,</span>

<span class="sd">        $$ \\mathbf{T}_\\mathrm{mzi} = \\mathbf{T}_\\mathrm{loss}(0, 0)\\mathbf{T}_\\mathrm{dc}(0.5)</span>
<span class="sd">        \\mathbf{T}_\\mathrm{ps}(2\\theta) \\mathbf{T}_\\mathrm{dc}(0.5) \\mathbf{T}_\\mathrm{ps}(\\phi) =</span>
<span class="sd">        ie^{i\\theta} \\begin{pmatrix} e^{i\\phi}\\sin{\\theta} &amp; \\cos{\\theta} \\\\ e^{i\\phi}\\cos{\\theta} &amp;</span>
<span class="sd">        -\\sin{\\theta} \\end{pmatrix}, $$</span>

<span class="sd">        in the ideal case of $t_1 = t_2 = 0.5$, $\\alpha_\\mathrm{up} = \\alpha_\\mathrm{low} = 0$.</span>

<span class="sd">        Using Clements encoding, any $m\\times m$ unitary matrix can be generated by multiplying a set of block</span>
<span class="sd">        diagonal unitary transformations $\\mathbf{T}_{p,q}(\\phi,\\theta)$ with the $m\\times m$ identity matrix in a</span>
<span class="sd">        specific order. Each transformation, $\\mathbf{T}_{p,q}$, features a $2\\times 2$ block that acts only on</span>
<span class="sd">        adjacent modes $p,q : p = q-1$. This $2\\times 2$ block is computed according to MZI description above.</span>
<span class="sd">        Transformations, $\\mathbf{T}_{p,q}$, are applied in each iteration of the loop. When the loop counter is</span>
<span class="sd">        even, `m0 = 0` such that the transformations for the first two optical modes and each consecutive adjacent</span>
<span class="sd">        pair are generated. For example, if $m = 5$, then the initial iteration will generate and apply $\\mathbf{</span>
<span class="sd">        T}_{0,1}$, $\\mathbf{T}_{2,3}$, while the second iteration (`m0 = 1`) produces $\\mathbf{T}_{1,2}$,</span>
<span class="sd">        $\\mathbf{T}_{3,4}$. Since the phases are respectively input in 1D arrays, it must be accessed specifically</span>
<span class="sd">        when generating the transformations. Each phase shift column ($\\phi$ or $\\theta$) requires as many phase</span>
<span class="sd">        parameters as there are transformations to generate in a given loop iteration. Thus, the input array is</span>
<span class="sd">        accessed according to the column and depends on $m$ and `m0` for the particular iteration. The matrix</span>
<span class="sd">        multiplications take place according to the order (left to right) in the figure above, Therefore,</span>
<span class="sd">        as an example, if a given iteration constructs two transformations, $\\mathbf{T}_{0,1}$ and</span>
<span class="sd">        $\\mathbf{T}_{2,3}$, the phase shifts must be ordered as $\\phi_{0,1}$, $\\phi_{2,3}$ in the array</span>
<span class="sd">        `phi`, and $\\theta_{0,1}$, $\\theta_{2,3}$ in the array `theta`.</span>

<span class="sd">        By applying all transformations in the specified order, followed by a column of output phase shifters on</span>
<span class="sd">        each mode, a rectangular mesh that represents the full $m \\times m$ single-photon unitary matrix is</span>
<span class="sd">        generated. This is displayed below, where each cross is a MZI.</span>

<span class="sd">        &lt;p align=&quot;center&quot;&gt;</span>
<span class="sd">        &lt;img width=&quot;500&quot; src=&quot;../img/light/mesh.png&quot; class=&quot;only-light&quot;&gt;</span>
<span class="sd">        &lt;img width=&quot;500&quot; src=&quot;../img/dark/mesh.png&quot; class=&quot;only-dark&quot;&gt;</span>
<span class="sd">        &lt;/p&gt;</span>

<span class="sd">        Mathematically, this procedure takes the form,</span>

<span class="sd">        $$ \\mathbf{U}(\\boldsymbol{\\phi}, \\boldsymbol{\\theta}) =</span>
<span class="sd">        \\mathbf{D}\\prod_{(p,q)\\in R}\\mathbf{T}_{p,q}(\\phi,\\theta), $$</span>

<span class="sd">        where $R$ is the sequence of the $\\frac{1}{2}m(m-1)$ two-mode transformations, $\\phi$, $\\theta$ are</span>
<span class="sd">        elements of the corresponding vectors $\\boldsymbol{\\phi}$, $\\boldsymbol{\\theta}$ that are selected</span>
<span class="sd">        according to the sequence, and $\\mathbf{D}$ is a diagonal $m\\times m$ matrix that is representative of the</span>
<span class="sd">        column of output phase shifters.</span>

<span class="sd">        It is termed a &quot;single-photon&quot; unitary as it is a representation only in the Fock basis of $m$ modes when $n</span>
<span class="sd">        = 1$. To obtain the &quot;multi-photon&quot; unitary, a transformation must be applied (see [aa](aa.md)).</span>

<span class="sd">        The code in this method is heavily inspired by [CasOptAx](https://github.com/JasvithBasani/CasOptAx), which is</span>
<span class="sd">        properly cited at the top of the page.</span>

<span class="sd">        Args:</span>
<span class="sd">            phi: $m(m-1)/2$ phase shifts, $\\boldsymbol{\\phi}$, for all MZIs in the mesh</span>
<span class="sd">            theta: $m(m-1)/2$ phase shifts, $\\boldsymbol{\\theta}$, for all MZIs in the mesh</span>
<span class="sd">            delta: $m$ phase shifts, $\\boldsymbol{\\delta}$, applied in each mode at the output of the mesh</span>

<span class="sd">        Returns:</span>
<span class="sd">            U: an $m\\times m$ 2D array representative of the linear unitary transformation,</span>
<span class="sd">                $\\mathbf{U}(\\boldsymbol{\\phi}, \\boldsymbol{\\theta}, \\boldsymbol{\\delta})$, enacted by the</span>
<span class="sd">                Clements mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check the validity of the mesh and the provided phases</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Clements encoding is only relevant for m &gt; 2, see &#39;mzi&#39; otherwise&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;There must be exactly m(m-1)/2 phi phase shifts&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;There must be exactly m(m-1)/2 theta phase shifts&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">),</span> <span class="s2">&quot;There must be exactly m delta phase shifts&quot;</span>

        <span class="c1"># ensure that the provided phases are jax arrays</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>

        <span class="c1"># iterate through each column of the mesh, constructing and multiplying the transformations for each MZI</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">m_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">odd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">%</span> <span class="mi">2</span>  <span class="c1"># equals 0 if even, 1 if odd</span>
        <span class="n">even</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>  <span class="c1"># equals 0 if odd, 1 if even</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="c1"># calculate whether MZIs should be inserted from mode 0 or mode 1</span>
            <span class="n">m0</span> <span class="o">=</span> <span class="n">col</span> <span class="o">%</span> <span class="mi">2</span>

            <span class="c1"># extract the parameters for the MZIs in this column</span>
            <span class="n">theta_col</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="n">ind</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">]</span>
            <span class="n">phi_col</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">ind</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">]</span>
            <span class="n">t_dc_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_dc</span><span class="p">[:,</span> <span class="n">ind</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">+=</span> <span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span>

            <span class="c1"># construct matrices that describe the transformations enacted by two full columns of T:R</span>
            <span class="c1"># directional couplers, nominally 50:50</span>
            <span class="n">dc_diag</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t_dc_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">dc_offdiag_up</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                        <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
                            <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_dc_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">))</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                        <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                        <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dc_offdiag_down</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                        <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_dc_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                        <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                        <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dc1</span> <span class="o">=</span> <span class="n">dc_diag</span> <span class="o">+</span> <span class="n">dc_offdiag_up</span> <span class="o">+</span> <span class="n">dc_offdiag_down</span>

            <span class="n">dc_diag</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t_dc_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">dc_offdiag_up</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                        <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
                            <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_dc_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">))</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                        <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                        <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dc_offdiag_down</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                        <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_dc_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                        <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                        <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                        <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">dc2</span> <span class="o">=</span> <span class="n">dc_diag</span> <span class="o">+</span> <span class="n">dc_offdiag_up</span> <span class="o">+</span> <span class="n">dc_offdiag_down</span>

            <span class="c1"># construct matrices that describe the transformations enacted by full columns of</span>
            <span class="c1"># phi &amp; 2theta phase shifters respectively</span>
            <span class="n">ps_phi</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi_col</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">odd</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span>
                    <span class="p">),</span>
                    <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">ps_2theta</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">theta_col</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">odd</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span>
                    <span class="p">),</span>
                    <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># construct matrix the describes the loss per arm of the interferometer mesh for this column</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ell_mzi</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]))</span>

            <span class="c1"># multiply each component of the MZI together to form the full transformation from this column</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">@</span> <span class="n">dc2</span> <span class="o">@</span> <span class="n">ps_2theta</span> <span class="o">@</span> <span class="n">dc1</span> <span class="o">@</span> <span class="n">ps_phi</span>

            <span class="c1"># add to list of column matrices that will multiply together at the end</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

        <span class="c1"># construct matrix that describes the transformation enacted by the output phase shifters in each mode</span>
        <span class="n">ps_delta</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">delta</span><span class="p">))</span>

        <span class="c1"># construct matrix that describes the loss per output phase shifter</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ell_ps</span><span class="p">))</span>

        <span class="c1"># multiply all the columns, followed by the output phase shifters, to construct the full mesh transformation</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">@</span> <span class="n">ps_delta</span> <span class="o">@</span> <span class="n">reduce</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">matmul</span><span class="p">,</span> <span class="n">columns</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">U</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np_ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np_ndarray</span><span class="p">,</span> <span class="n">np_ndarray</span><span class="p">,</span> <span class="n">np_ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform Clements decomposition on a square $m\\times m$ unitary matrix.</span>

<span class="sd">        Given some linear $m\\times m$ unitary transformation, where $m$ is the number of optical modes, this method</span>
<span class="sd">        performs Clements decomposition to determine the phase shifts ($\\phi, \\theta$) for each MZI such that the</span>
<span class="sd">        mesh performs this transformation. For more details on the decomposition procedure, see [W. R. Clements *et</span>
<span class="sd">        al*., &quot;Optimal design for universal multiport interferometers&quot;, *Optica* **3**, 1460-1465 (2016)](</span>
<span class="sd">        https://doi.org/10.1364/OPTICA.3.001460). This method is adapted from the [Interferometer](</span>
<span class="sd">        https://github.com/clementsw/interferometer) repository.</span>

<span class="sd">        The main difference between this implementation and the original by Clements *et al*. is the form of the MZI</span>
<span class="sd">        transfer matrix assumed. In the ideal case, a MZI is described by,</span>

<span class="sd">        $$ ie^{i\\theta}\\begin{pmatrix} e^{i\\phi}\\sin{\\theta} &amp; \\cos{\\theta} \\\\ e^{i\\phi}\\cos{\\theta} &amp;</span>
<span class="sd">        -\\sin{\\theta} \\end{pmatrix}. $$</span>

<span class="sd">        Clements *et al*. chose to perform a transformation, $\\theta\\to\\frac{\\pi}{2}-\\theta$,</span>
<span class="sd">        $\\phi\\to\\phi+\\pi$, to achieve the form,</span>

<span class="sd">        $$ e^{-i\\theta}\\begin{pmatrix} e^{i\\phi}\\cos{\\theta} &amp; -\\sin{\\theta} \\\\ e^{i\\phi}\\sin{\\theta} &amp;</span>
<span class="sd">        \\cos{\\theta} \\end{pmatrix}. $$</span>

<span class="sd">        Here, this transformation is undone by applying the inverse transformation, $\\theta\\to\\frac{\\pi}{</span>
<span class="sd">        2}-\\theta$, $\\phi\\to\\phi+\\pi$, at each stage of the decomposition procedure. This function concludes by</span>
<span class="sd">        arranging the phase shifts as required for the encoding scheme specified in `encode`.</span>

<span class="sd">        Args:</span>
<span class="sd">            U: $m\\times m$ unitary matrix, $\\mathbf{U}(\\boldsymbol{\\phi}, \\boldsymbol{\\theta},</span>
<span class="sd">                \\boldsymbol{\\delta})$, to perform Clements decomposition on</span>

<span class="sd">        Returns:</span>
<span class="sd">            phi: array of $m(m-1)/2$ phase shifts, $\\boldsymbol{\\phi}$, for all MZIs in the mesh</span>
<span class="sd">            theta: array of $m(m-1)/2$ phase shifts, $\\boldsymbol{\\theta}$, for all MZIs in the mesh</span>
<span class="sd">            delta: array of $m$ phase shifts, $\\boldsymbol{\\delta}$, applied in each mode at the output of the mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check that U is m x m</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Unitary matrix must be a 2D array&quot;</span>
        <span class="k">assert</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Unitary matrix must be m x m&quot;</span>
        <span class="k">assert</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Unitary matrix must be m x m&quot;</span>

        <span class="c1"># initialize lists of MZIs and T_{p,q} applied from the left</span>
        <span class="n">MZIs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">T_lefts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># need to zero out m - 1 diagonal sections from the matrix U</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># for even i, multiply from the right</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># store modes that T acts on</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="c1"># compute phi, theta to 0 out matrix element</span>
                    <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                        <span class="k">if</span> <span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>

                    <span class="c1"># from phi, theta, construct T_{p,q}^{-1}, then right-multiply</span>
                    <span class="n">T_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                    <span class="n">T_right</span><span class="p">[</span><span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzi_inv</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">T_right</span><span class="p">)</span>

                    <span class="c1"># append MZI to list, noting modes and phases</span>
                    <span class="n">MZIs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;pq&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">phi</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">})</span>

            <span class="c1"># for odd i, multiply from the left</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># store modes that T acts on</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="c1"># compute phi, theta to 0 out matrix element</span>
                    <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                        <span class="k">if</span> <span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="o">-</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="p">)</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">]))</span>

                    <span class="c1"># from phi, theta, construct T_{p,q}, then left-multiply</span>
                    <span class="n">T_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                    <span class="n">T_left</span><span class="p">[</span><span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzi</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T_left</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>

                    <span class="c1"># append left-multiplying T_{p,q} to list, noting modes and phases</span>
                    <span class="n">T_lefts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;pq&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">phi</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">})</span>

        <span class="c1"># check that the resultant matrix, $D$, is diagonal</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)),</span> <span class="s2">&quot;Decomposition did not yield a diagonal matrix D&quot;</span>

        <span class="c1"># rearrange the transformations to match the encoding scheme</span>
        <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">T_lefts</span><span class="p">):</span>
            <span class="c1"># extract modes, phases for the T_{p,q}</span>
            <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="s2">&quot;pq&quot;</span><span class="p">]</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span>

            <span class="c1"># construct T_{p,q}^{-1}, then left-multiply</span>
            <span class="n">T_left_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
            <span class="n">T_left_inv</span><span class="p">[</span><span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzi_inv</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T_left_inv</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>

            <span class="c1"># compute phi, theta that allow T_{p,q}^{-1} to be multiplied on the right</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">if</span> <span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">/</span> <span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">]))</span>

            <span class="c1"># from phi, theta, construct T_{p,q}^{-1}, then right-multiply</span>
            <span class="n">T_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
            <span class="n">T_right</span><span class="p">[</span><span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzi_inv</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">T_right</span><span class="p">)</span>

            <span class="c1"># append MZI to list, noting modes and phases</span>
            <span class="n">MZIs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;pq&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">phi</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">})</span>

        <span class="c1"># check that the resultant matrix, $D&#39;$, is diagonal</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)),</span> <span class="s2">&quot;Decomposition did not yield a diagonal matrix D&#39;&quot;</span>

        <span class="c1"># compute output phases from the diagonal of the resultant matrix U</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>

        <span class="c1"># sort the MZIs by mode pair and the order in which they must be applied</span>
        <span class="n">sorted_MZIs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">MZI</span> <span class="ow">in</span> <span class="n">MZIs</span><span class="p">:</span>
            <span class="n">sorted_MZIs</span><span class="p">[</span><span class="n">MZI</span><span class="p">[</span><span class="s2">&quot;pq&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MZI</span><span class="p">)</span>

        <span class="c1"># extract the phi, theta phase shifts from the sorted MZIs in the correct order</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">indp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">indt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="n">m0</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">MZI</span> <span class="o">=</span> <span class="n">sorted_MZIs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">phi</span><span class="p">[</span><span class="n">indp</span><span class="p">]</span> <span class="o">=</span> <span class="n">MZI</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span>
                <span class="n">theta</span><span class="p">[</span><span class="n">indt</span><span class="p">]</span> <span class="o">=</span> <span class="n">MZI</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span>

                <span class="n">indp</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">indt</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">delta</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h3 id="quotonic.clements.Mesh.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ell_mzi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ell_ps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t_dc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#quotonic.clements.Mesh.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialization of a Mach-Zehnder interferometer mesh arranged in the Clements configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>m</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of optical modes, <span class="arithmatex">\(m\)</span></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ell_mzi</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="np_ndarray = np.ndarray

  
      module-attribute
   (quotonic.types.np_ndarray)" href="../types/#quotonic.types.np_ndarray">np_ndarray</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(m\times m\)</span> array containing the percentage loss per arm of the interferometer mesh,
for each column of MZIs respectively</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ell_ps</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="np_ndarray = np.ndarray

  
      module-attribute
   (quotonic.types.np_ndarray)" href="../types/#quotonic.types.np_ndarray">np_ndarray</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(m\)</span>-length array containing the percentage loss for each of the output phase shifters</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>t_dc</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="np_ndarray = np.ndarray

  
      module-attribute
   (quotonic.types.np_ndarray)" href="../types/#quotonic.types.np_ndarray">np_ndarray</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(2\times m(m-1)/2\)</span> array containing the splitting ratio (T:R) of each directional coupler in the
mesh, organized such that each column corresponds to one MZI, the top row being the first
directional coupler and the bottom being the second, where the MZIs are ordered from top to bottom
followed by left to right across the mesh</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/quotonic/clements.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">ell_mzi</span><span class="p">:</span> <span class="n">np_ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ell_ps</span><span class="p">:</span> <span class="n">np_ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">t_dc</span><span class="p">:</span> <span class="n">np_ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialization of a Mach-Zehnder interferometer mesh arranged in the Clements configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        m: number of optical modes, $m$</span>
<span class="sd">        ell_mzi: $m\\times m$ array containing the percentage loss per arm of the interferometer mesh,</span>
<span class="sd">            for each column of MZIs respectively</span>
<span class="sd">        ell_ps: $m$-length array containing the percentage loss for each of the output phase shifters</span>
<span class="sd">        t_dc: $2\\times m(m-1)/2$ array containing the splitting ratio (T:R) of each directional coupler in the</span>
<span class="sd">            mesh, organized such that each column corresponds to one MZI, the top row being the first</span>
<span class="sd">            directional coupler and the bottom being the second, where the MZIs are ordered from top to bottom</span>
<span class="sd">            followed by left to right across the mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># fill in missing mesh properties</span>
    <span class="k">if</span> <span class="n">ell_mzi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ell_mzi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ell_ps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ell_ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t_dc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">t_dc</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># check the validity of the provided properties</span>
    <span class="k">assert</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Cannot create any kind of interferometer with less than 2 modes&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">ell_mzi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ell_mzi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">ell_mzi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span>
    <span class="p">),</span> <span class="s2">&quot;Loss per arm of the interferometer mesh must take the form of an m x m array&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ell_ps</span><span class="p">)</span> <span class="o">==</span> <span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Loss per output phase shifter in the mesh must be an m-length array&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">t_dc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">t_dc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="p">),</span> <span class="s2">&quot;Directional coupler splitting ratios (T:R) must be passed as a 2 x m(m-1)/2 array&quot;</span>

    <span class="c1"># store the properties of the mesh internally</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ell_mzi</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ell_mzi</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ell_ps</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ell_ps</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">t_dc</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t_dc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="quotonic.clements.Mesh.mzi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mzi</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span></code>

<a href="#quotonic.clements.Mesh.mzi" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Construct <span class="arithmatex">\(2\times 2\)</span> <em>ideal</em> Mach-Zehnder interferometer transfer matrix.</p>
<p>The transfer matrix is defined as,</p>
<div class="arithmatex">\[ \mathbf{T}_\mathrm{mzi} = ie^{i\theta}\begin{pmatrix} e^{i\phi}\sin{\theta} &amp; \cos{\theta}
\\ e^{i\phi}\cos{\theta} &amp; -\sin{\theta} \end{pmatrix}, \]</div>
<p>in the ideal case. See <code>encode</code> for further details.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>phi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>phase shift <span class="arithmatex">\(\phi\)</span>, in radians</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>theta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>phase shift <span class="arithmatex">\(\theta\)</span>, in radians</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <span class="arithmatex">\(2\times 2\)</span> complex 2D array representation of the ideal Mach-Zehnder interferometer transfer matrix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/quotonic/clements.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mzi</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">phi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp_ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct $2\\times 2$ *ideal* Mach-Zehnder interferometer transfer matrix.</span>

<span class="sd">    The transfer matrix is defined as,</span>

<span class="sd">    $$ \\mathbf{T}_\\mathrm{mzi} = ie^{i\\theta}\\begin{pmatrix} e^{i\\phi}\\sin{\\theta} &amp; \\cos{\\theta}</span>
<span class="sd">    \\\\ e^{i\\phi}\\cos{\\theta} &amp; -\\sin{\\theta} \\end{pmatrix}, $$</span>

<span class="sd">    in the ideal case. See `encode` for further details.</span>

<span class="sd">    Args:</span>
<span class="sd">        phi: phase shift $\\phi$, in radians</span>
<span class="sd">        theta: phase shift $\\theta$, in radians</span>

<span class="sd">    Returns:</span>
<span class="sd">        A $2\\times 2$ complex 2D array representation of the ideal Mach-Zehnder interferometer transfer matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T00</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">T01</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">T10</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">T11</span> <span class="o">=</span> <span class="o">-</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">T00</span><span class="p">,</span> <span class="n">T01</span><span class="p">],</span> <span class="p">[</span><span class="n">T10</span><span class="p">,</span> <span class="n">T11</span><span class="p">]])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="quotonic.clements.Mesh.mzi_inv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mzi_inv</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span></code>

<a href="#quotonic.clements.Mesh.mzi_inv" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Construct <span class="arithmatex">\(2\times 2\)</span> inverse of an <em>ideal</em> Mach-Zehnder interferometer transfer matrix.</p>
<p>The inverse of the transfer matrix is defined as,</p>
<div class="arithmatex">\[ \mathbf{T}_\mathrm{mzi}^\dagger = -ie^{-i\theta}\begin{pmatrix} e^{-i\phi}\sin{\theta} &amp; e^{-i\phi}
\cos{\theta} \\ \cos{\theta} &amp; -\sin{\theta} \end{pmatrix}, \]</div>
<p>in the ideal case. See <code>encode</code> for further details.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>phi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>phase shift <span class="arithmatex">\(\phi\)</span>, in radians</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>theta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>phase shift <span class="arithmatex">\(\theta\)</span>, in radians</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <span class="arithmatex">\(2\times 2\)</span> complex 2D array representation of the inverse of the ideal Mach-Zehnder interferometer
transfer matrix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/quotonic/clements.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mzi_inv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">phi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp_ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct $2\\times 2$ inverse of an *ideal* Mach-Zehnder interferometer transfer matrix.</span>

<span class="sd">    The inverse of the transfer matrix is defined as,</span>

<span class="sd">    $$ \\mathbf{T}_\\mathrm{mzi}^\\dagger = -ie^{-i\\theta}\\begin{pmatrix} e^{-i\\phi}\\sin{\\theta} &amp; e^{-i\\phi}</span>
<span class="sd">    \\cos{\\theta} \\\\ \\cos{\\theta} &amp; -\\sin{\\theta} \\end{pmatrix}, $$</span>

<span class="sd">    in the ideal case. See `encode` for further details.</span>

<span class="sd">    Args:</span>
<span class="sd">        phi: phase shift $\\phi$, in radians</span>
<span class="sd">        theta: phase shift $\\theta$, in radians</span>

<span class="sd">    Returns:</span>
<span class="sd">        A $2\\times 2$ complex 2D array representation of the inverse of the ideal Mach-Zehnder interferometer</span>
<span class="sd">            transfer matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T00</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">T01</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">T10</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">T11</span> <span class="o">=</span> <span class="o">-</span><span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">T00</span><span class="p">,</span> <span class="n">T01</span><span class="p">],</span> <span class="p">[</span><span class="n">T10</span><span class="p">,</span> <span class="n">T11</span><span class="p">]])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="quotonic.clements.Mesh.encode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">encode</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span></code>

<a href="#quotonic.clements.Mesh.encode" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Encode a Mach-Zehnder interferometer mesh in the Clements configuration from an array of phase shifts.</p>
<p>Each Mach-Zehnder interferometer (MZI), as displayed below, consists of two phase shifters enacting respective
phase shifts <span class="arithmatex">\(\phi\)</span>, <span class="arithmatex">\(\theta\)</span>, and two directional couplers with respective splitting ratios <span class="arithmatex">\(t_1\)</span>,
<span class="arithmatex">\(t_2\)</span> (ideally, <span class="arithmatex">\(t_1 = t_2 = 0.5\)</span>).</p>
<p align="center">
<img width="500" src="../img/light/mzi.png" class="only-light">
<img width="500" src="../img/dark/mzi.png" class="only-dark">
</p>

<p>The phase shifter transfer matrices are given by,</p>
<div class="arithmatex">\[ \mathbf{T}_\mathrm{ps}(\phi) = \begin{pmatrix} e^{i\phi} &amp; 0 \\ 0 &amp; 1 \end{pmatrix} \qquad\qquad
\mathbf{T}_\mathrm{ps}(2\theta) = \begin{pmatrix} e^{i2\theta} &amp; 0 \\ 0 &amp; 1 \end{pmatrix}, \]</div>
<p>for phase shifts <span class="arithmatex">\(\phi\)</span> and <span class="arithmatex">\(2\theta\)</span> respectively. The directional coupler transfer matrix is given by,</p>
<div class="arithmatex">\[ \mathbf{T}_\mathrm{dc}(t) = \begin{pmatrix} \sqrt{t} &amp; i\sqrt{1-t} \\ i\sqrt{1-t} &amp; \sqrt{t}
\end{pmatrix}, \]</div>
<p>which simplifies to,</p>
<div class="arithmatex">\[ \mathbf{T}_\mathrm{dc}(0.5) = \frac{1}{\sqrt{2}}\begin{pmatrix} 1 &amp; i \\ i &amp; 1 \end{pmatrix}, \]</div>
<p>in the ideal case of <span class="arithmatex">\(t = 0.5\)</span> (i.e. 50:50). Each MZI may contribute an imbalanced probability of photon loss
in each of its arms. This is modelled by multiplying a loss matrix,</p>
<div class="arithmatex">\[ \mathbf{T}_\mathrm{loss}(\alpha_\mathrm{up}, \alpha_\mathrm{low}) = \begin{pmatrix}
\sqrt{1 - \alpha_\mathrm{up}} &amp; 0 \\ 0 &amp; \sqrt{1 - \alpha_\mathrm{low}} \end{pmatrix}, \]</div>
<p>where <span class="arithmatex">\(\alpha_\mathrm{up}\)</span>, <span class="arithmatex">\(\alpha_\mathrm{low}\)</span> are the fractions of light lost in the upper and lower
arms of the MZI, respectively. Altogether, the MZI transfer matrix is given by,</p>
<div class="arithmatex">\[ \mathbf{T}_\mathrm{mzi} = \mathbf{T}_\mathrm{loss}(\alpha_\mathrm{up}, \alpha_\mathrm{low})
\mathbf{T}_\mathrm{dc}(t_2) \mathbf{T}_\mathrm{ps}(2\theta) \mathbf{T}_\mathrm{dc}(t_1)
\mathbf{T}_\mathrm{ps}(\phi) = \begin{pmatrix} \sqrt{1 - \alpha_\mathrm{up}} &amp; 0 \\ 0 &amp; \sqrt{1 -
\alpha_\mathrm{low}} \end{pmatrix} \begin{pmatrix} \sqrt{t_2} &amp; i\sqrt{1-t_2} \\ i\sqrt{1-t_2} &amp;
\sqrt{t_2} \end{pmatrix} \begin{pmatrix} e^{i2\theta} &amp; 0 \\ 0 &amp; 1 \end{pmatrix} \begin{pmatrix}
\sqrt{t_1} &amp; i\sqrt{1-t_1} \\ i\sqrt{1-t_1} &amp; \sqrt{t_1} \end{pmatrix} \begin{pmatrix} e^{i\phi} &amp; 0
\\ 0 &amp; 1 \end{pmatrix}, \]</div>
<p>which simplifies to,</p>
<div class="arithmatex">\[ \mathbf{T}_\mathrm{mzi} = \mathbf{T}_\mathrm{loss}(0, 0)\mathbf{T}_\mathrm{dc}(0.5)
\mathbf{T}_\mathrm{ps}(2\theta) \mathbf{T}_\mathrm{dc}(0.5) \mathbf{T}_\mathrm{ps}(\phi) =
ie^{i\theta} \begin{pmatrix} e^{i\phi}\sin{\theta} &amp; \cos{\theta} \\ e^{i\phi}\cos{\theta} &amp;
-\sin{\theta} \end{pmatrix}, \]</div>
<p>in the ideal case of <span class="arithmatex">\(t_1 = t_2 = 0.5\)</span>, <span class="arithmatex">\(\alpha_\mathrm{up} = \alpha_\mathrm{low} = 0\)</span>.</p>
<p>Using Clements encoding, any <span class="arithmatex">\(m\times m\)</span> unitary matrix can be generated by multiplying a set of block
diagonal unitary transformations <span class="arithmatex">\(\mathbf{T}_{p,q}(\phi,\theta)\)</span> with the <span class="arithmatex">\(m\times m\)</span> identity matrix in a
specific order. Each transformation, <span class="arithmatex">\(\mathbf{T}_{p,q}\)</span>, features a <span class="arithmatex">\(2\times 2\)</span> block that acts only on
adjacent modes <span class="arithmatex">\(p,q : p = q-1\)</span>. This <span class="arithmatex">\(2\times 2\)</span> block is computed according to MZI description above.
Transformations, <span class="arithmatex">\(\mathbf{T}_{p,q}\)</span>, are applied in each iteration of the loop. When the loop counter is
even, <code>m0 = 0</code> such that the transformations for the first two optical modes and each consecutive adjacent
pair are generated. For example, if <span class="arithmatex">\(m = 5\)</span>, then the initial iteration will generate and apply <span class="arithmatex">\(\mathbf{
T}_{0,1}\)</span>, <span class="arithmatex">\(\mathbf{T}_{2,3}\)</span>, while the second iteration (<code>m0 = 1</code>) produces <span class="arithmatex">\(\mathbf{T}_{1,2}\)</span>,
<span class="arithmatex">\(\mathbf{T}_{3,4}\)</span>. Since the phases are respectively input in 1D arrays, it must be accessed specifically
when generating the transformations. Each phase shift column (<span class="arithmatex">\(\phi\)</span> or <span class="arithmatex">\(\theta\)</span>) requires as many phase
parameters as there are transformations to generate in a given loop iteration. Thus, the input array is
accessed according to the column and depends on <span class="arithmatex">\(m\)</span> and <code>m0</code> for the particular iteration. The matrix
multiplications take place according to the order (left to right) in the figure above, Therefore,
as an example, if a given iteration constructs two transformations, <span class="arithmatex">\(\mathbf{T}_{0,1}\)</span> and
<span class="arithmatex">\(\mathbf{T}_{2,3}\)</span>, the phase shifts must be ordered as <span class="arithmatex">\(\phi_{0,1}\)</span>, <span class="arithmatex">\(\phi_{2,3}\)</span> in the array
<code>phi</code>, and <span class="arithmatex">\(\theta_{0,1}\)</span>, <span class="arithmatex">\(\theta_{2,3}\)</span> in the array <code>theta</code>.</p>
<p>By applying all transformations in the specified order, followed by a column of output phase shifters on
each mode, a rectangular mesh that represents the full <span class="arithmatex">\(m \times m\)</span> single-photon unitary matrix is
generated. This is displayed below, where each cross is a MZI.</p>
<p align="center">
<img width="500" src="../img/light/mesh.png" class="only-light">
<img width="500" src="../img/dark/mesh.png" class="only-dark">
</p>

<p>Mathematically, this procedure takes the form,</p>
<div class="arithmatex">\[ \mathbf{U}(\boldsymbol{\phi}, \boldsymbol{\theta}) =
\mathbf{D}\prod_{(p,q)\in R}\mathbf{T}_{p,q}(\phi,\theta), \]</div>
<p>where <span class="arithmatex">\(R\)</span> is the sequence of the <span class="arithmatex">\(\frac{1}{2}m(m-1)\)</span> two-mode transformations, <span class="arithmatex">\(\phi\)</span>, <span class="arithmatex">\(\theta\)</span> are
elements of the corresponding vectors <span class="arithmatex">\(\boldsymbol{\phi}\)</span>, <span class="arithmatex">\(\boldsymbol{\theta}\)</span> that are selected
according to the sequence, and <span class="arithmatex">\(\mathbf{D}\)</span> is a diagonal <span class="arithmatex">\(m\times m\)</span> matrix that is representative of the
column of output phase shifters.</p>
<p>It is termed a "single-photon" unitary as it is a representation only in the Fock basis of <span class="arithmatex">\(m\)</span> modes when <span class="arithmatex">\(n
= 1\)</span>. To obtain the "multi-photon" unitary, a transformation must be applied (see <a href="../aa/">aa</a>).</p>
<p>The code in this method is heavily inspired by <a href="https://github.com/JasvithBasani/CasOptAx">CasOptAx</a>, which is
properly cited at the top of the page.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>phi</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(m(m-1)/2\)</span> phase shifts, <span class="arithmatex">\(\boldsymbol{\phi}\)</span>, for all MZIs in the mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>theta</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(m(m-1)/2\)</span> phase shifts, <span class="arithmatex">\(\boldsymbol{\theta}\)</span>, for all MZIs in the mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delta</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(m\)</span> phase shifts, <span class="arithmatex">\(\boldsymbol{\delta}\)</span>, applied in each mode at the output of the mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>U</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="jnp_ndarray = jnp.ndarray

  
      module-attribute
   (quotonic.types.jnp_ndarray)" href="../types/#quotonic.types.jnp_ndarray">jnp_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>an <span class="arithmatex">\(m\times m\)</span> 2D array representative of the linear unitary transformation,
<span class="arithmatex">\(\mathbf{U}(\boldsymbol{\phi}, \boldsymbol{\theta}, \boldsymbol{\delta})\)</span>, enacted by the
Clements mesh</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/quotonic/clements.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">phi</span><span class="p">:</span> <span class="n">jnp_ndarray</span><span class="p">,</span>
    <span class="n">theta</span><span class="p">:</span> <span class="n">jnp_ndarray</span><span class="p">,</span>
    <span class="n">delta</span><span class="p">:</span> <span class="n">jnp_ndarray</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp_ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a Mach-Zehnder interferometer mesh in the Clements configuration from an array of phase shifts.</span>

<span class="sd">    Each Mach-Zehnder interferometer (MZI), as displayed below, consists of two phase shifters enacting respective</span>
<span class="sd">    phase shifts $\\phi$, $\\theta$, and two directional couplers with respective splitting ratios $t_1$,</span>
<span class="sd">    $t_2$ (ideally, $t_1 = t_2 = 0.5$).</span>

<span class="sd">    &lt;p align=&quot;center&quot;&gt;</span>
<span class="sd">    &lt;img width=&quot;500&quot; src=&quot;../img/light/mzi.png&quot; class=&quot;only-light&quot;&gt;</span>
<span class="sd">    &lt;img width=&quot;500&quot; src=&quot;../img/dark/mzi.png&quot; class=&quot;only-dark&quot;&gt;</span>
<span class="sd">    &lt;/p&gt;</span>

<span class="sd">    The phase shifter transfer matrices are given by,</span>

<span class="sd">    $$ \\mathbf{T}_\\mathrm{ps}(\\phi) = \\begin{pmatrix} e^{i\\phi} &amp; 0 \\\\ 0 &amp; 1 \\end{pmatrix} \\qquad\\qquad</span>
<span class="sd">    \\mathbf{T}_\\mathrm{ps}(2\\theta) = \\begin{pmatrix} e^{i2\\theta} &amp; 0 \\\\ 0 &amp; 1 \\end{pmatrix}, $$</span>

<span class="sd">    for phase shifts $\\phi$ and $2\\theta$ respectively. The directional coupler transfer matrix is given by,</span>

<span class="sd">    $$ \\mathbf{T}_\\mathrm{dc}(t) = \\begin{pmatrix} \\sqrt{t} &amp; i\\sqrt{1-t} \\\\ i\\sqrt{1-t} &amp; \\sqrt{t}</span>
<span class="sd">    \\end{pmatrix}, $$</span>

<span class="sd">    which simplifies to,</span>

<span class="sd">    $$ \\mathbf{T}_\\mathrm{dc}(0.5) = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1 &amp; i \\\\ i &amp; 1 \\end{pmatrix}, $$</span>

<span class="sd">    in the ideal case of $t = 0.5$ (i.e. 50:50). Each MZI may contribute an imbalanced probability of photon loss</span>
<span class="sd">    in each of its arms. This is modelled by multiplying a loss matrix,</span>

<span class="sd">    $$ \\mathbf{T}_\\mathrm{loss}(\\alpha_\\mathrm{up}, \\alpha_\\mathrm{low}) = \\begin{pmatrix}</span>
<span class="sd">    \\sqrt{1 - \\alpha_\\mathrm{up}} &amp; 0 \\\\ 0 &amp; \\sqrt{1 - \\alpha_\\mathrm{low}} \\end{pmatrix}, $$</span>

<span class="sd">    where $\\alpha_\\mathrm{up}$, $\\alpha_\\mathrm{low}$ are the fractions of light lost in the upper and lower</span>
<span class="sd">    arms of the MZI, respectively. Altogether, the MZI transfer matrix is given by,</span>

<span class="sd">    $$ \\mathbf{T}_\\mathrm{mzi} = \\mathbf{T}_\\mathrm{loss}(\\alpha_\\mathrm{up}, \\alpha_\\mathrm{low})</span>
<span class="sd">    \\mathbf{T}_\\mathrm{dc}(t_2) \\mathbf{T}_\\mathrm{ps}(2\\theta) \\mathbf{T}_\\mathrm{dc}(t_1)</span>
<span class="sd">    \\mathbf{T}_\\mathrm{ps}(\\phi) = \\begin{pmatrix} \\sqrt{1 - \\alpha_\\mathrm{up}} &amp; 0 \\\\ 0 &amp; \\sqrt{1 -</span>
<span class="sd">    \\alpha_\\mathrm{low}} \\end{pmatrix} \\begin{pmatrix} \\sqrt{t_2} &amp; i\\sqrt{1-t_2} \\\\ i\\sqrt{1-t_2} &amp;</span>
<span class="sd">    \\sqrt{t_2} \\end{pmatrix} \\begin{pmatrix} e^{i2\\theta} &amp; 0 \\\\ 0 &amp; 1 \\end{pmatrix} \\begin{pmatrix}</span>
<span class="sd">    \\sqrt{t_1} &amp; i\\sqrt{1-t_1} \\\\ i\\sqrt{1-t_1} &amp; \\sqrt{t_1} \\end{pmatrix} \\begin{pmatrix} e^{i\\phi} &amp; 0</span>
<span class="sd">    \\\\ 0 &amp; 1 \\end{pmatrix}, $$</span>

<span class="sd">    which simplifies to,</span>

<span class="sd">    $$ \\mathbf{T}_\\mathrm{mzi} = \\mathbf{T}_\\mathrm{loss}(0, 0)\\mathbf{T}_\\mathrm{dc}(0.5)</span>
<span class="sd">    \\mathbf{T}_\\mathrm{ps}(2\\theta) \\mathbf{T}_\\mathrm{dc}(0.5) \\mathbf{T}_\\mathrm{ps}(\\phi) =</span>
<span class="sd">    ie^{i\\theta} \\begin{pmatrix} e^{i\\phi}\\sin{\\theta} &amp; \\cos{\\theta} \\\\ e^{i\\phi}\\cos{\\theta} &amp;</span>
<span class="sd">    -\\sin{\\theta} \\end{pmatrix}, $$</span>

<span class="sd">    in the ideal case of $t_1 = t_2 = 0.5$, $\\alpha_\\mathrm{up} = \\alpha_\\mathrm{low} = 0$.</span>

<span class="sd">    Using Clements encoding, any $m\\times m$ unitary matrix can be generated by multiplying a set of block</span>
<span class="sd">    diagonal unitary transformations $\\mathbf{T}_{p,q}(\\phi,\\theta)$ with the $m\\times m$ identity matrix in a</span>
<span class="sd">    specific order. Each transformation, $\\mathbf{T}_{p,q}$, features a $2\\times 2$ block that acts only on</span>
<span class="sd">    adjacent modes $p,q : p = q-1$. This $2\\times 2$ block is computed according to MZI description above.</span>
<span class="sd">    Transformations, $\\mathbf{T}_{p,q}$, are applied in each iteration of the loop. When the loop counter is</span>
<span class="sd">    even, `m0 = 0` such that the transformations for the first two optical modes and each consecutive adjacent</span>
<span class="sd">    pair are generated. For example, if $m = 5$, then the initial iteration will generate and apply $\\mathbf{</span>
<span class="sd">    T}_{0,1}$, $\\mathbf{T}_{2,3}$, while the second iteration (`m0 = 1`) produces $\\mathbf{T}_{1,2}$,</span>
<span class="sd">    $\\mathbf{T}_{3,4}$. Since the phases are respectively input in 1D arrays, it must be accessed specifically</span>
<span class="sd">    when generating the transformations. Each phase shift column ($\\phi$ or $\\theta$) requires as many phase</span>
<span class="sd">    parameters as there are transformations to generate in a given loop iteration. Thus, the input array is</span>
<span class="sd">    accessed according to the column and depends on $m$ and `m0` for the particular iteration. The matrix</span>
<span class="sd">    multiplications take place according to the order (left to right) in the figure above, Therefore,</span>
<span class="sd">    as an example, if a given iteration constructs two transformations, $\\mathbf{T}_{0,1}$ and</span>
<span class="sd">    $\\mathbf{T}_{2,3}$, the phase shifts must be ordered as $\\phi_{0,1}$, $\\phi_{2,3}$ in the array</span>
<span class="sd">    `phi`, and $\\theta_{0,1}$, $\\theta_{2,3}$ in the array `theta`.</span>

<span class="sd">    By applying all transformations in the specified order, followed by a column of output phase shifters on</span>
<span class="sd">    each mode, a rectangular mesh that represents the full $m \\times m$ single-photon unitary matrix is</span>
<span class="sd">    generated. This is displayed below, where each cross is a MZI.</span>

<span class="sd">    &lt;p align=&quot;center&quot;&gt;</span>
<span class="sd">    &lt;img width=&quot;500&quot; src=&quot;../img/light/mesh.png&quot; class=&quot;only-light&quot;&gt;</span>
<span class="sd">    &lt;img width=&quot;500&quot; src=&quot;../img/dark/mesh.png&quot; class=&quot;only-dark&quot;&gt;</span>
<span class="sd">    &lt;/p&gt;</span>

<span class="sd">    Mathematically, this procedure takes the form,</span>

<span class="sd">    $$ \\mathbf{U}(\\boldsymbol{\\phi}, \\boldsymbol{\\theta}) =</span>
<span class="sd">    \\mathbf{D}\\prod_{(p,q)\\in R}\\mathbf{T}_{p,q}(\\phi,\\theta), $$</span>

<span class="sd">    where $R$ is the sequence of the $\\frac{1}{2}m(m-1)$ two-mode transformations, $\\phi$, $\\theta$ are</span>
<span class="sd">    elements of the corresponding vectors $\\boldsymbol{\\phi}$, $\\boldsymbol{\\theta}$ that are selected</span>
<span class="sd">    according to the sequence, and $\\mathbf{D}$ is a diagonal $m\\times m$ matrix that is representative of the</span>
<span class="sd">    column of output phase shifters.</span>

<span class="sd">    It is termed a &quot;single-photon&quot; unitary as it is a representation only in the Fock basis of $m$ modes when $n</span>
<span class="sd">    = 1$. To obtain the &quot;multi-photon&quot; unitary, a transformation must be applied (see [aa](aa.md)).</span>

<span class="sd">    The code in this method is heavily inspired by [CasOptAx](https://github.com/JasvithBasani/CasOptAx), which is</span>
<span class="sd">    properly cited at the top of the page.</span>

<span class="sd">    Args:</span>
<span class="sd">        phi: $m(m-1)/2$ phase shifts, $\\boldsymbol{\\phi}$, for all MZIs in the mesh</span>
<span class="sd">        theta: $m(m-1)/2$ phase shifts, $\\boldsymbol{\\theta}$, for all MZIs in the mesh</span>
<span class="sd">        delta: $m$ phase shifts, $\\boldsymbol{\\delta}$, applied in each mode at the output of the mesh</span>

<span class="sd">    Returns:</span>
<span class="sd">        U: an $m\\times m$ 2D array representative of the linear unitary transformation,</span>
<span class="sd">            $\\mathbf{U}(\\boldsymbol{\\phi}, \\boldsymbol{\\theta}, \\boldsymbol{\\delta})$, enacted by the</span>
<span class="sd">            Clements mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check the validity of the mesh and the provided phases</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Clements encoding is only relevant for m &gt; 2, see &#39;mzi&#39; otherwise&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;There must be exactly m(m-1)/2 phi phase shifts&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;There must be exactly m(m-1)/2 theta phase shifts&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">),</span> <span class="s2">&quot;There must be exactly m delta phase shifts&quot;</span>

    <span class="c1"># ensure that the provided phases are jax arrays</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>

    <span class="c1"># iterate through each column of the mesh, constructing and multiplying the transformations for each MZI</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">m_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">odd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">%</span> <span class="mi">2</span>  <span class="c1"># equals 0 if even, 1 if odd</span>
    <span class="n">even</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>  <span class="c1"># equals 0 if odd, 1 if even</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
        <span class="c1"># calculate whether MZIs should be inserted from mode 0 or mode 1</span>
        <span class="n">m0</span> <span class="o">=</span> <span class="n">col</span> <span class="o">%</span> <span class="mi">2</span>

        <span class="c1"># extract the parameters for the MZIs in this column</span>
        <span class="n">theta_col</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="n">ind</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">]</span>
        <span class="n">phi_col</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">ind</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">]</span>
        <span class="n">t_dc_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_dc</span><span class="p">[:,</span> <span class="n">ind</span> <span class="p">:</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">+=</span> <span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span>

        <span class="c1"># construct matrices that describe the transformations enacted by two full columns of T:R</span>
        <span class="c1"># directional couplers, nominally 50:50</span>
        <span class="n">dc_diag</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t_dc_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">dc_offdiag_up</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_dc_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">))</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dc_offdiag_down</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_dc_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dc1</span> <span class="o">=</span> <span class="n">dc_diag</span> <span class="o">+</span> <span class="n">dc_offdiag_up</span> <span class="o">+</span> <span class="n">dc_offdiag_down</span>

        <span class="n">dc_diag</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t_dc_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">dc_offdiag_up</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_dc_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">))</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dc_offdiag_down</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                    <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">),</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t_dc_col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                    <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dc2</span> <span class="o">=</span> <span class="n">dc_diag</span> <span class="o">+</span> <span class="n">dc_offdiag_up</span> <span class="o">+</span> <span class="n">dc_offdiag_down</span>

        <span class="c1"># construct matrices that describe the transformations enacted by full columns of</span>
        <span class="c1"># phi &amp; 2theta phase shifters respectively</span>
        <span class="n">ps_phi</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phi_col</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">odd</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span>
                <span class="p">),</span>
                <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ps_2theta</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span> <span class="o">*</span> <span class="n">theta_col</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">m_2</span> <span class="o">-</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">odd</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m0</span> <span class="o">*</span> <span class="n">even</span>
                <span class="p">),</span>
                <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="p">(</span><span class="n">m0</span> <span class="o">+</span> <span class="n">odd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                <span class="n">constant_values</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># construct matrix the describes the loss per arm of the interferometer mesh for this column</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ell_mzi</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]))</span>

        <span class="c1"># multiply each component of the MZI together to form the full transformation from this column</span>
        <span class="n">column</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">@</span> <span class="n">dc2</span> <span class="o">@</span> <span class="n">ps_2theta</span> <span class="o">@</span> <span class="n">dc1</span> <span class="o">@</span> <span class="n">ps_phi</span>

        <span class="c1"># add to list of column matrices that will multiply together at the end</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>

    <span class="c1"># construct matrix that describes the transformation enacted by the output phase shifters in each mode</span>
    <span class="n">ps_delta</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">delta</span><span class="p">))</span>

    <span class="c1"># construct matrix that describes the loss per output phase shifter</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ell_ps</span><span class="p">))</span>

    <span class="c1"># multiply all the columns, followed by the output phase shifters, to construct the full mesh transformation</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">@</span> <span class="n">ps_delta</span> <span class="o">@</span> <span class="n">reduce</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">matmul</span><span class="p">,</span> <span class="n">columns</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">U</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h3 id="quotonic.clements.Mesh.decode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decode</span><span class="p">(</span><span class="n">U</span><span class="p">)</span></code>

<a href="#quotonic.clements.Mesh.decode" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform Clements decomposition on a square <span class="arithmatex">\(m\times m\)</span> unitary matrix.</p>
<p>Given some linear <span class="arithmatex">\(m\times m\)</span> unitary transformation, where <span class="arithmatex">\(m\)</span> is the number of optical modes, this method
performs Clements decomposition to determine the phase shifts (<span class="arithmatex">\(\phi, \theta\)</span>) for each MZI such that the
mesh performs this transformation. For more details on the decomposition procedure, see <a href="https://doi.org/10.1364/OPTICA.3.001460">W. R. Clements <em>et
al</em>., "Optimal design for universal multiport interferometers", <em>Optica</em> <strong>3</strong>, 1460-1465 (2016)</a>. This method is adapted from the <a href="https://github.com/clementsw/interferometer">Interferometer</a> repository.</p>
<p>The main difference between this implementation and the original by Clements <em>et al</em>. is the form of the MZI
transfer matrix assumed. In the ideal case, a MZI is described by,</p>
<div class="arithmatex">\[ ie^{i\theta}\begin{pmatrix} e^{i\phi}\sin{\theta} &amp; \cos{\theta} \\ e^{i\phi}\cos{\theta} &amp;
-\sin{\theta} \end{pmatrix}. \]</div>
<p>Clements <em>et al</em>. chose to perform a transformation, <span class="arithmatex">\(\theta\to\frac{\pi}{2}-\theta\)</span>,
<span class="arithmatex">\(\phi\to\phi+\pi\)</span>, to achieve the form,</p>
<div class="arithmatex">\[ e^{-i\theta}\begin{pmatrix} e^{i\phi}\cos{\theta} &amp; -\sin{\theta} \\ e^{i\phi}\sin{\theta} &amp;
\cos{\theta} \end{pmatrix}. \]</div>
<p>Here, this transformation is undone by applying the inverse transformation, <span class="arithmatex">\(\theta\to\frac{\pi}{
2}-\theta\)</span>, <span class="arithmatex">\(\phi\to\phi+\pi\)</span>, at each stage of the decomposition procedure. This function concludes by
arranging the phase shifts as required for the encoding scheme specified in <code>encode</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>U</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="np_ndarray = np.ndarray

  
      module-attribute
   (quotonic.types.np_ndarray)" href="../types/#quotonic.types.np_ndarray">np_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><span class="arithmatex">\(m\times m\)</span> unitary matrix, <span class="arithmatex">\(\mathbf{U}(\boldsymbol{\phi}, \boldsymbol{\theta},
\boldsymbol{\delta})\)</span>, to perform Clements decomposition on</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>phi</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="np_ndarray = np.ndarray

  
      module-attribute
   (quotonic.types.np_ndarray)" href="../types/#quotonic.types.np_ndarray">np_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of <span class="arithmatex">\(m(m-1)/2\)</span> phase shifts, <span class="arithmatex">\(\boldsymbol{\phi}\)</span>, for all MZIs in the mesh</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>theta</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="np_ndarray = np.ndarray

  
      module-attribute
   (quotonic.types.np_ndarray)" href="../types/#quotonic.types.np_ndarray">np_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of <span class="arithmatex">\(m(m-1)/2\)</span> phase shifts, <span class="arithmatex">\(\boldsymbol{\theta}\)</span>, for all MZIs in the mesh</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>delta</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="np_ndarray = np.ndarray

  
      module-attribute
   (quotonic.types.np_ndarray)" href="../types/#quotonic.types.np_ndarray">np_ndarray</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of <span class="arithmatex">\(m\)</span> phase shifts, <span class="arithmatex">\(\boldsymbol{\delta}\)</span>, applied in each mode at the output of the mesh</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/quotonic/clements.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np_ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np_ndarray</span><span class="p">,</span> <span class="n">np_ndarray</span><span class="p">,</span> <span class="n">np_ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform Clements decomposition on a square $m\\times m$ unitary matrix.</span>

<span class="sd">    Given some linear $m\\times m$ unitary transformation, where $m$ is the number of optical modes, this method</span>
<span class="sd">    performs Clements decomposition to determine the phase shifts ($\\phi, \\theta$) for each MZI such that the</span>
<span class="sd">    mesh performs this transformation. For more details on the decomposition procedure, see [W. R. Clements *et</span>
<span class="sd">    al*., &quot;Optimal design for universal multiport interferometers&quot;, *Optica* **3**, 1460-1465 (2016)](</span>
<span class="sd">    https://doi.org/10.1364/OPTICA.3.001460). This method is adapted from the [Interferometer](</span>
<span class="sd">    https://github.com/clementsw/interferometer) repository.</span>

<span class="sd">    The main difference between this implementation and the original by Clements *et al*. is the form of the MZI</span>
<span class="sd">    transfer matrix assumed. In the ideal case, a MZI is described by,</span>

<span class="sd">    $$ ie^{i\\theta}\\begin{pmatrix} e^{i\\phi}\\sin{\\theta} &amp; \\cos{\\theta} \\\\ e^{i\\phi}\\cos{\\theta} &amp;</span>
<span class="sd">    -\\sin{\\theta} \\end{pmatrix}. $$</span>

<span class="sd">    Clements *et al*. chose to perform a transformation, $\\theta\\to\\frac{\\pi}{2}-\\theta$,</span>
<span class="sd">    $\\phi\\to\\phi+\\pi$, to achieve the form,</span>

<span class="sd">    $$ e^{-i\\theta}\\begin{pmatrix} e^{i\\phi}\\cos{\\theta} &amp; -\\sin{\\theta} \\\\ e^{i\\phi}\\sin{\\theta} &amp;</span>
<span class="sd">    \\cos{\\theta} \\end{pmatrix}. $$</span>

<span class="sd">    Here, this transformation is undone by applying the inverse transformation, $\\theta\\to\\frac{\\pi}{</span>
<span class="sd">    2}-\\theta$, $\\phi\\to\\phi+\\pi$, at each stage of the decomposition procedure. This function concludes by</span>
<span class="sd">    arranging the phase shifts as required for the encoding scheme specified in `encode`.</span>

<span class="sd">    Args:</span>
<span class="sd">        U: $m\\times m$ unitary matrix, $\\mathbf{U}(\\boldsymbol{\\phi}, \\boldsymbol{\\theta},</span>
<span class="sd">            \\boldsymbol{\\delta})$, to perform Clements decomposition on</span>

<span class="sd">    Returns:</span>
<span class="sd">        phi: array of $m(m-1)/2$ phase shifts, $\\boldsymbol{\\phi}$, for all MZIs in the mesh</span>
<span class="sd">        theta: array of $m(m-1)/2$ phase shifts, $\\boldsymbol{\\theta}$, for all MZIs in the mesh</span>
<span class="sd">        delta: array of $m$ phase shifts, $\\boldsymbol{\\delta}$, applied in each mode at the output of the mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check that U is m x m</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Unitary matrix must be a 2D array&quot;</span>
    <span class="k">assert</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Unitary matrix must be m x m&quot;</span>
    <span class="k">assert</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Unitary matrix must be m x m&quot;</span>

    <span class="c1"># initialize lists of MZIs and T_{p,q} applied from the left</span>
    <span class="n">MZIs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">T_lefts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># need to zero out m - 1 diagonal sections from the matrix U</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># for even i, multiply from the right</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># store modes that T acts on</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c1"># compute phi, theta to 0 out matrix element</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                    <span class="k">if</span> <span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>

                <span class="c1"># from phi, theta, construct T_{p,q}^{-1}, then right-multiply</span>
                <span class="n">T_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                <span class="n">T_right</span><span class="p">[</span><span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzi_inv</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">T_right</span><span class="p">)</span>

                <span class="c1"># append MZI to list, noting modes and phases</span>
                <span class="n">MZIs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;pq&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">phi</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">})</span>

        <span class="c1"># for odd i, multiply from the left</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># store modes that T acts on</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span>
                <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="c1"># compute phi, theta to 0 out matrix element</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                    <span class="k">if</span> <span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="o">-</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">]))</span>

                <span class="c1"># from phi, theta, construct T_{p,q}, then left-multiply</span>
                <span class="n">T_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
                <span class="n">T_left</span><span class="p">[</span><span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzi</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T_left</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>

                <span class="c1"># append left-multiplying T_{p,q} to list, noting modes and phases</span>
                <span class="n">T_lefts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;pq&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">phi</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">})</span>

    <span class="c1"># check that the resultant matrix, $D$, is diagonal</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)),</span> <span class="s2">&quot;Decomposition did not yield a diagonal matrix D&quot;</span>

    <span class="c1"># rearrange the transformations to match the encoding scheme</span>
    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">T_lefts</span><span class="p">):</span>
        <span class="c1"># extract modes, phases for the T_{p,q}</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="s2">&quot;pq&quot;</span><span class="p">]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span>

        <span class="c1"># construct T_{p,q}^{-1}, then left-multiply</span>
        <span class="n">T_left_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">T_left_inv</span><span class="p">[</span><span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzi_inv</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T_left_inv</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>

        <span class="c1"># compute phi, theta that allow T_{p,q}^{-1} to be multiplied on the right</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">if</span> <span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">/</span> <span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">]))</span>

        <span class="c1"># from phi, theta, construct T_{p,q}^{-1}, then right-multiply</span>
        <span class="n">T_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">T_right</span><span class="p">[</span><span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span> <span class="p">:</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mzi_inv</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">T_right</span><span class="p">)</span>

        <span class="c1"># append MZI to list, noting modes and phases</span>
        <span class="n">MZIs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;pq&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">phi</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="p">})</span>

    <span class="c1"># check that the resultant matrix, $D&#39;$, is diagonal</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)),</span> <span class="s2">&quot;Decomposition did not yield a diagonal matrix D&#39;&quot;</span>

    <span class="c1"># compute output phases from the diagonal of the resultant matrix U</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>

    <span class="c1"># sort the MZIs by mode pair and the order in which they must be applied</span>
    <span class="n">sorted_MZIs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">MZI</span> <span class="ow">in</span> <span class="n">MZIs</span><span class="p">:</span>
        <span class="n">sorted_MZIs</span><span class="p">[</span><span class="n">MZI</span><span class="p">[</span><span class="s2">&quot;pq&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MZI</span><span class="p">)</span>

    <span class="c1"># extract the phi, theta phase shifts from the sorted MZIs in the correct order</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">indp</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">indt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
        <span class="n">m0</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">MZI</span> <span class="o">=</span> <span class="n">sorted_MZIs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">phi</span><span class="p">[</span><span class="n">indp</span><span class="p">]</span> <span class="o">=</span> <span class="n">MZI</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span>
            <span class="n">theta</span><span class="p">[</span><span class="n">indt</span><span class="p">]</span> <span class="o">=</span> <span class="n">MZI</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span>

            <span class="n">indp</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">indt</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">delta</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Maintained by <a href="https://www.linkedin.com/in/jacobewaniuk/">Jacob Ewaniuk</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/jewaniuk/quotonic" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/quotonic" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.tracking", "toc.integrate", "navigation.instant", "navigation.top", "navigation.tabs", "navigation.prune"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../js/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>